/**
 * @author yangyufei
 * @date 2019-03-05 09:42:52
 * @desc
 */
const redisConnector    = require('../../../lib/db_manager/redis_connector');
const helper            = require('../../helper');


describe('lib/db_manager/redis_connector', () => {
    it('#getInstance', async () => {
        await helper(async () => {
            let logger = {};
            ['trace', 'debug', 'info', 'warn', 'error', 'fatal'].forEach(level => {
                logger[level] = () => {};
            });

            let config;

            if (process.env.SERVER_IP) {
                config = {host: process.env.SERVER_IP, port: 6379, password: 'CMCC10086'};
            } else {
                config = {host: '127.0.0.1', port: 6379, password: '19871102'};
            }

            let redis = await redisConnector.getInstance(config, logger, 'redis');

            try {
                await redis.exists('aaa');

                return true;
            } catch (err) {
                return false;
            } finally {
                await redis.disconnect();
            }
        });
    });
});
