/**
 * @author yangyufei
 * @date 2019-02-26 17:06:28
 * @desc
 */
const path      = require('path');

const cfgLoader = require('../../lib/config_loader');
const helper    = require('../helper');

describe('测试 config_loader.js', () => {
    it('整体测试', async () => {
        await helper(() => {
            try {
                cfgLoader();
                console.error('cfgLoader的cfgDirPath为null,应该抛出错误！');
                return
            } catch (err) {}

            let cfg = cfgLoader(path.join(__dirname, 'config'), {
                SITE_NAME   : 'site-test',

                spider: {
                    run: {
                        type: 'cron'
                    }
                }
            });

            return cfg.ERROR_OBJ.SUCCESS.code === 0 &&
                cfg.SITE_NAME === 'site-test' &&
                cfg.spider.run.type === 'cron' &&
                cfg.NAME === 'test' &&
                cfg.MONITOR === false &&
                cfg.spider.fetch.timeout === 100 &&
                (cfg.redis.port === 2000 || cfg.redis.port === 3000);
        });
    });
});